{% extends "base.html" %}

{% block content %}

<br>
<h1 style="text-align: center;">Abstract Machine Interpreter</h1>
<p style="text-align: justify; font-size: 0.90rem;">
  This is a web-based interpreter for a variety of abstract computational models, 
  each involving different methods of memory storage, memory access, and input-output access.
  The following procedures are supported: Step by State, which allows you to step through 
  the execution of a machine one state at a time and Multiple Run, which allows you to run 
  multiple inputs and view the final output of the machines. <br>
</p>


<div class="alert alert-success" role="alert">
  {% if index == -1 %}
    <b>Input:</b> {empty}
  {% else %}
    <span>
      {% if initialized %}
      <b>Input:</b>
      {{ input_string[:index]|safe }}  <!-- Part before the index -->
      <span style="color: red; font-weight: bold;">{{ input_string[index] }}</span>  <!-- Highlighted part -->
      {{ input_string[index+1:]|safe }}  <!-- Part after the index -->
      {% else %}
      <b>Input:</b> {empty}
      {% endif %}
    </span>
  {% endif %}
</div>

<div class="alert alert-warning" role="alert">
  {% if initialized %}
  <b></b> {{ mem_contents | safe }}
  {% else %}
  <b>Memory:</b> {empty}
  {% endif %}
</div>


<div class="content-container">
  <div class="left-container">
    
    <form method="post">
      <div class="form-group editor-container">
        <label for="machine-definition" style="font-weight: bold;">Machine Definition</label>
        <div class="editor-wrapper">
            <div id="line-numbers" class="line-numbers"></div>
            <textarea 
                id="machine-definition" 
                name="machine-definition" 
                class="form-control text-area"
                rows="10"
                placeholder=
".DATA
TAPE T1

.LOGIC
A] RIGHT(T1) (0/X,B), (Y/Y,D), (1/1,reject)
B] RIGHT(T1) (0/0,B), (Y/Y,B), (1/Y,C)
C] LEFT(T1) (0/0,C), (Y/Y,C), (X/X,A)
D] RIGHT(T1) (Y/Y,D), (#/#,accept), (1/1,reject)

# Press Tab to use placeholder as input"
                oninput="updateLineNumbers()" 
                onscroll="syncScroll()"
                {% if initialized %}disabled{% endif %}
            >{{ md }}</textarea>
        </div>
    </div>

      <div class="form-group editor-container">
        <label for="input-string" style="font-weight: bold;">Input String</label>
        <textarea 
          id="input-string" 
          name="input-string" 
          class="form-control" 
          rows="1" 
          style="resize: none;"
          placeholder="1110110101 # Press Tab to use placeholder as input"
          {% if initialized %}disabled{% endif %}
          >{{ input_string }}</textarea>
      </div>
  </div>

  <div class="right-container">
      <br>
      <div class="alert alert-danger" role="alert">
        {% if output == "" %}
          <b>Output:</b> {empty}
        {% else %}
          <b>Current Output:</b> {{ output_string }}
        {% endif %}
      </div>
      <div class="alert alert-info" role="alert">
        {% if initialized %}
          <b>Current State:</b> {{ state }}
        {% else %}
          <b>Current State:</b> {empty}
        {% endif %}
      </div>
      <div class="alert alert-primary" role="alert">
        {% if initialized %}
        <b>Step Count:</b> {{ step_count }}
        {% else %}
        <b>Step Count:</b> 0
        {% endif %}
      </div>
  </div>
</div>

<div class="button-container">
  <form method="post">
    {% if not initialized %}
      <input type="submit" class="btn btn-danger" id="startBtn" name="start" value="Start">
    {% else %}
      <input type="submit" class="btn btn-warning" id="stepBtn" name="step" value="Step">
    {% endif %}
    <input type="button" class="btn btn-success" name="finish" value="Fast Run" style="margin-left: 10px;">
    <input type="submit" class="btn btn-secondary" name="reset" value="Reset" style="margin-left: 10px;">
  </form>
</div>

<br>
<p style="text-align: justify; font-size: 0.90rem;">
  Current Procedure: <b>{{ type }}</b>. A text field for the machine definition, which includes the .DATA and .LOGIC sections,
  and a text field for the input string is provided. An example of the machine definition and input string is shown above. 
  More information about which memory storage and operations are supported can be found <a href="">here</a>.
</p>
<p style="text-align: center; font-size: 0.75rem; font-style: italic;">Developed by: Francis I. Bawa | CSC615M G01</p>

{% endblock %}